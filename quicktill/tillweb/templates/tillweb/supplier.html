{% extends "tillweb/tillweb.html" %}

{% block title %}{{till}} â€” supplier {{supplier.name}}{% endblock %}

{% block tillcontent %}

{% if form %}
<form action="" method="post">{% csrf_token %}
  {% include "form-horizontal.html" %}
  <button class="btn btn-primary mb-2" type="submit" name="submit_update">
    Update
  </button>
  <button class="btn btn-danger mb-2" type="submit" name="submit_delete"{% if not can_delete %} disabled{% endif %}>
    Delete
  </button>
</form>
{% else %}
<table class="kvtable">
<tr><th scope="row">Name:</th><td>{{supplier.name}}</td></tr>
<tr><th scope="row">Telephone:</th><td>{{supplier.tel}}</td></tr>
<tr><th scope="row">Email:</th><td>{{supplier.email}}</td></tr>
<tr><th scope="row">Web:</th><td>{% if supplier.web %}<a href="{{supplier.web|urlencode}}">{{supplier.web}}</a>{% endif %}</td></tr>
</table>
{% endif %}
{% if supplier.accounts_url %}
<a class="btn btn-secondary float-right" href="{{supplier.accounts_url}}">View in accounts</a>
{% endif %}

<h2>Deliveries</h2>

<table class="table table-striped table-sm" id="deliveries">
  <thead class="thead-light">
    <tr>
      <th scope="col">ID</th>
      <th scope="col">Date</th>
      <th scope="col">Document</th>
      <th scope="col">Confirmed?</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script type="text/javascript">
  $(document).ready(function(){
    $("#deliveries").DataTable({
	ajax: {
	    url: '{% url "tillweb-datatable-deliveries" pubname=pubname %}',
	    dataSrc: 'data',
	    data: function (d) {
		d.supplierid = {{supplier.id}};
	    },
	},
	columns: [
	    { data: 'id',
	      render: render_link('url', DataTable.render.text()) },
	    { data: 'date',
	      render: render_link('url', DataTable.render.date()),
	      searchable: false },
	    { data: 'docnumber',
	      render: DataTable.render.text() },
	    { data: 'checked',
	      render: render_yesno(),
	      searchable: false },
	],
	order: [ [0, 'desc'] ],
	searching: true,
	paging: true,
	serverSide: true
    });
  });
</script>

{% if supplier.logs %}
<h2>Log entries</h2>
{% with logs=supplier.logs %}
{% include "tillweb/loglist.html" %}
{% endwith %}
{% endif %}

{% endblock %}
